{% extends "base.html" %} {% block content %}
<h1>User management</h1>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th>Active</th>
      <th>Study Program</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <td>{{ user.full_name }}</td>
      <td>{{ user.email }}</td>
      <td>
        {% set roles = [] %} {% if user.is_student %} {% set _ =
        roles.append('Student') %} {% endif %} {% if user.is_teacher %} {% set _
        = roles.append('Teacher') %} {% endif %} {% if user.is_admin %} {% set _
        = roles.append('Admin') %} {% endif %} {{ roles | join(', ') }}
      </td>
      <td>{{ 'Yes' if user.is_active else 'No' }}</td>
      <td>
        {% if user.is_student and user.student_info %} {{
        user.student_info.study_program.name if user.student_info.study_program
        else 'None' }} {% else %} - {% endif %}
      </td>
      <td>
        <a href="{{ url_for('admin.edit_user', user_id=user.id) }}">Edit</a>

        {% if user.email != 'admin@example.com' %}
        <form
          method="POST"
          action="{{ url_for('admin.deactivate_user', user_id=user.id) }}"
          style="display: inline"
        >
          {{ form.csrf_token() }}
          <button type="submit">Deactivate</button>
        </form>

        <form
          method="POST"
          action="{{ url_for('admin.delete_user', user_id=user.id) }}"
          style="display: inline"
        >
          {{ form.csrf_token() }}
          <button
            type="submit"
            onclick="return confirm('Are you sure you want to delete this user?')"
          >
            Delete
          </button>
        </form>
        {% else %}
        <span>Super Admin</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
